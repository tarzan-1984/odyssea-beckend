# üìä Prisma Migrations - –ó–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã?

## ü§î –ß—Ç–æ —Ç–∞–∫–æ–µ Prisma Migrations?

Prisma Migrations - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç:

1. **–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î
2. **–ü—Ä–∏–º–µ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ
3. **–û—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É** –º–µ–∂–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏

## üéØ –ó–∞—á–µ–º –Ω—É–∂–Ω—ã Migrations?

### 1. **–í–µ—Ä—Å–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**

–ë–µ–∑ migrations:
```
‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏
‚ùå –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚ùå –°–ª–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
‚ùå –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –≤ –∫–æ–º–∞–Ω–¥–µ
```

–° migrations:
```
‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è
‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∫ –ª—é–±–æ–π –≤–µ—Ä—Å–∏–∏
‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Git
‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

### 2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**

```sql
-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏
ALTER TABLE users ADD COLUMN phone VARCHAR(20);

-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞
ALTER TABLE users ALTER COLUMN email TYPE VARCHAR(255);

-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏
ALTER TABLE users DROP COLUMN old_field;
```

### 3. **–ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**

```bash
# –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ A —Å–æ–∑–¥–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é
yarn prisma:migrate

# –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ B –ø–æ–ª—É—á–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull
yarn prisma:migrate

# –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Å—Ö–µ–º–æ–π –ë–î
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Migrations

```
prisma/
‚îú‚îÄ‚îÄ schema.prisma          # –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ migrations/            # –ü–∞–ø–∫–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ 20250808093700_/  # –ü–µ—Ä–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migration.sql  # SQL —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ migration_lock.toml # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–µ—Ä—Å–∏–∏ Prisma
‚îî‚îÄ‚îÄ seed.ts               # –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã**
```prisma
// prisma/schema.prisma
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  username  String   @unique
  password  String
  phone     String?  // ‚Üê –î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤–æ–µ –ø–æ–ª–µ
  role      UserRole @default(USER)
  status    Status   @default(ACTIVE)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}
```

### 2. **–°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
```bash
yarn prisma:migrate
# Prisma —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### 3. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
```bash
# –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
yarn prisma:migrate:deploy

# –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
yarn prisma:migrate
```

## üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
# –°–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
yarn prisma:migrate

# –¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (–±–µ–∑ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è)
yarn prisma:migrate dev --create-only

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
yarn prisma:migrate:deploy
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π
```bash
# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É (–±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π)
yarn db:push

# –°–±—Ä–æ—Å–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
yarn db:reset

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
npx prisma migrate status
```

### –û—Ç–ª–∞–¥–∫–∞
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä SQL –º–∏–≥—Ä–∞—Ü–∏–∏
cat prisma/migrations/20250808093700_/migration.sql

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã
npx prisma validate

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
yarn prisma:generate
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
```prisma
// 1. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É
model User {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  phone String?  // ‚Üê –ù–æ–≤–æ–µ –ø–æ–ª–µ
}
```

```bash
# 2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
yarn prisma:migrate
```

```sql
-- 3. Prisma —Å–æ–∑–¥–∞—Å—Ç SQL
ALTER TABLE "public"."users" ADD COLUMN "phone" TEXT;
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ–ª—è
```prisma
// 1. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É
model User {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  email String @unique @db.VarChar(255)  // ‚Üê –ò–∑–º–µ–Ω–∏–ª–∏ —Ç–∏–ø
}
```

```sql
-- 2. Prisma —Å–æ–∑–¥–∞—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
ALTER TABLE "public"."users" ALTER COLUMN "email" TYPE VARCHAR(255);
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
```prisma
// 1. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É
model User {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  @@index([createdAt])  // ‚Üê –ù–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å
}
```

```sql
-- 2. Prisma —Å–æ–∑–¥–∞—Å—Ç –∏–Ω–¥–µ–∫—Å
CREATE INDEX "users_createdAt_idx" ON "public"."users"("createdAt");
```

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é**
```bash
‚ùå –ù–ï –î–ï–õ–ê–ô–¢–ï –≠–¢–û–ì–û:
vim prisma/migrations/20250808093700_/migration.sql

‚úÖ –í–ú–ï–°–¢–û –≠–¢–û–ì–û:
# –ò–∑–º–µ–Ω–∏—Ç–µ schema.prisma –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
yarn prisma:migrate
```

### 2. **–í—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**
```bash
# –í –∫–æ–º–∞–Ω–¥–µ
git pull                    # –ü–æ–ª—É—á–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
yarn prisma:migrate         # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
yarn prisma:generate        # –û–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç
```

### 3. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –±–æ–ª—å—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏**
```bash
# –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
docker-compose exec postgres pg_dump -U postgres odyssea_db > backup.sql

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
yarn prisma:migrate

# –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker-compose exec -T postgres psql -U postgres -d odyssea_db < backup.sql
```

## üîÑ –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# 1. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É
vim prisma/schema.prisma

# 2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
yarn prisma:migrate

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
yarn prisma:studio

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
yarn test

# 5. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .
git commit -m "feat: add phone field to User model"
```

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
```bash
# 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
yarn prisma:migrate:deploy

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
npx prisma migrate status

# 3. –û–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç
yarn prisma:generate
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Migrations

‚úÖ **–í–µ—Ä—Å–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ  
‚úÖ **–ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Å—Ö–µ–º–æ–π  
‚úÖ **–û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ª—é–±–æ–π –≤–µ—Ä—Å–∏–∏  
‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - SQL —Ñ–∞–π–ª—ã —Å–ª—É–∂–∞—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - CI/CD –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏  

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Prisma Migrations Documentation](https://www.prisma.io/docs/concepts/components/prisma-migrate)
- [Migration Commands](https://www.prisma.io/docs/reference/api-reference/command-reference)
- [Best Practices](https://www.prisma.io/docs/guides/migrate/developing-with-prisma-migrate)

---

**–í—ã–≤–æ–¥:** Migrations - —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö! üéØ
