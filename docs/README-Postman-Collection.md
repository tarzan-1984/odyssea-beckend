# Odyssea API - Postman Collection

## Обзор

Этот документ описывает полную Postman коллекцию для тестирования всех эндпоинтов Odyssea Backend API.

## Файлы коллекции

1. **Odyssea-Authentication-API.postman_collection.json** - Оригинальная коллекция только с эндпоинтами аутентификации
2. **Odyssea-Complete-API.postman_collection.json** - Полная коллекция со всеми эндпоинтами API

## Импорт коллекции

1. Откройте Postman
2. Нажмите "Import" в левом верхнем углу
3. Выберите файл `Odyssea-Complete-API.postman_collection.json`
4. Коллекция будет импортирована со всеми эндпоинтами

## Переменные коллекции

Коллекция использует следующие переменные:

- `baseUrl` - Базовый URL API (по умолчанию: http://localhost:3000)
- `apiPrefix` - Префикс версии API (по умолчанию: v1)
- `accessToken` - JWT токен доступа (устанавливается автоматически)
- `refreshToken` - JWT токен обновления (устанавливается автоматически)
- `userEmail` - Email тестового пользователя
- `userPassword` - Пароль тестового пользователя
- `userId` - ID пользователя (устанавливается автоматически)
- `chatRoomId` - ID чат-комнаты (устанавливается автоматически)
- `messageId` - ID сообщения (устанавливается автоматически)

## Структура коллекции

### 1. Authentication (Аутентификация)
- **User Login** - Вход с email и паролем
- **Verify OTP** - Подтверждение OTP кода
- **Social Login** - Вход через Google OAuth
- **Google OAuth Callback** - Обработка callback от Google
- **Forgot Password** - Запрос сброса пароля
- **Reset Password** - Сброс пароля по токену
- **Refresh Token** - Обновление токена доступа
- **Logout** - Выход из системы

### 2. Users (Пользователи)
- **Create User** - Создание пользователя (только для админов)
- **Get All Users** - Получение списка пользователей с фильтрацией
- **Get Current User Profile** - Получение профиля текущего пользователя
- **Get User by ID** - Получение пользователя по ID
- **Update Current User Profile** - Обновление профиля текущего пользователя
- **Update User** - Обновление пользователя (только для админов)
- **Delete User** - Удаление пользователя (только для админов)
- **Change User Status** - Изменение статуса пользователя (только для админов)

### 3. Chat Rooms (Чат-комнаты)
- **Create Chat Room** - Создание чат-комнаты
- **Get User Chat Rooms** - Получение чат-комнат пользователя
- **Get Chat Room by ID** - Получение чат-комнаты по ID
- **Archive Chat Room** - Архивирование чат-комнаты
- **Add Participants** - Добавление участников в чат-комнату
- **Search Users for Chat** - Поиск пользователей для добавления в чат

### 4. Messages (Сообщения)
- **Send Message** - Отправка сообщения
- **Upload File** - Загрузка файла в чат
- **Get Chat Room Messages** - Получение сообщений чат-комнаты
- **Search Messages** - Поиск сообщений в чат-комнате
- **Get Message Statistics** - Получение статистики сообщений
- **Get Unread Count** - Получение количества непрочитанных сообщений
- **Mark Message as Read** - Отметка сообщения как прочитанного
- **Delete Message** - Удаление сообщения

### 5. Health Check & Documentation
- **Health Check** - Проверка работоспособности API
- **Swagger Documentation** - Доступ к документации Swagger
- **Swagger JSON** - JSON схема API

## Автоматизация

Коллекция включает автоматические скрипты:

### Pre-request Scripts
- Добавляет временную метку к запросам
- Логирует URL запроса

### Test Scripts
- Проверяет время ответа (< 5000ms)
- Проверяет валидность JSON
- Проверяет статус ответа
- Автоматически устанавливает токены после успешной аутентификации
- Автоматически устанавливает ID пользователей, чат-комнат и сообщений

## Порядок тестирования

1. **Настройка переменных**:
   - Установите `userEmail` и `userPassword` для тестового пользователя
   - Убедитесь, что `baseUrl` указывает на правильный сервер

2. **Аутентификация**:
   - Выполните "User Login" для получения OTP
   - Выполните "Verify OTP" для получения токенов
   - Токены будут автоматически установлены в переменные

3. **Тестирование пользователей**:
   - Используйте "Get Current User Profile" для проверки профиля
   - Используйте "Get All Users" для получения списка пользователей

4. **Тестирование чатов**:
   - Создайте чат-комнату с помощью "Create Chat Room"
   - Добавьте участников с помощью "Add Participants"

5. **Тестирование сообщений**:
   - Отправьте сообщение с помощью "Send Message"
   - Получите сообщения с помощью "Get Chat Room Messages"

## Новые поля в API

### Поле taxId
- **Тип**: string
- **Обязательное**: Да (при создании пользователя)
- **Описание**: Налоговый идентификатор пользователя
- **Пример**: "12-3456789"

### Поля адреса
- **city** - Город
- **country** - Страна
- **state** - Штат/провинция
- **zip** - Почтовый индекс
- **location** - Общее местоположение
- **vin** - Идентификационный номер транспортного средства

## Ошибки и устранение неполадок

### 401 Unauthorized
- Убедитесь, что токен доступа установлен и действителен
- Выполните повторную аутентификацию

### 403 Forbidden
- Проверьте права доступа пользователя
- Некоторые эндпоинты доступны только администраторам

### 404 Not Found
- Проверьте правильность URL и параметров
- Убедитесь, что ресурс существует

### 422 Validation Error
- Проверьте формат данных в теле запроса
- Убедитесь, что все обязательные поля заполнены

## Мониторинг

Коллекция включает глобальные тесты для мониторинга:
- Время ответа
- Валидность JSON
- Статус ответа

Все тесты выполняются автоматически для каждого запроса.

## Поддержка

Для получения помощи:
1. Проверьте логи приложения
2. Убедитесь, что все переменные окружения настроены
3. Проверьте документацию Swagger по адресу `http://localhost:3000/docs`
